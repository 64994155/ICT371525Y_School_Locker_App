@model ICT371525Y_School_Locker_App.Models.LockerDashboardViewModel

@{
    ViewBag.Title = "Locker Dashboard";
}

<div class="container mt-5" style="max-width: 1100px;">
    <div class="border p-4 shadow-sm rounded bg-light">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-center flex-grow-1 m-0">
                <i class="bi bi-box-seam"></i> Locker System Dashboard
            </h2>

            <!-- Back button -->
            <a asp-controller="Admin" asp-action="Index" asp-route-adminId="@ViewBag.AdminId"
               class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle"></i> Back to Admin Page
            </a>
        </div>

        <!-- Filter Form -->
        <form method="get" asp-action="Index" class="row g-3 mb-4">
            <!-- Booking Year -->
            <div class="col-md-4">
                <label class="form-label">Booking Year</label>
                <select name="year" class="form-select">
                    <option value="2025" selected="@(ViewBag.SelectedYear == 2025)">2025</option>
                    <option value="2026" selected="@(ViewBag.SelectedYear == 2026)">2026</option>
                </select>
            </div>

            <!-- Grade Filter (with "All" option) -->
            <div class="col-md-4">
                <label class="form-label">Grade</label>

                @{
                    var qGrade = Context.Request.Query["gradeId"].ToString();
                }

                <select name="gradeId" class="form-select">
                    <option value="">All Grades</option>

                    @for (var i = 8; i <= 12; i++)
                    {
                        if (qGrade == i.ToString())
                        {
                            <option value="@i" selected>@i</option>
                        }
                        else
                        {
                            <option value="@i">@i</option>
                        }
                    }
                </select>
            </div>

            <!-- Admin Approved Filter -->
            <div class="col-md-4">
                <label class="form-label">Admin Approved</label>
                <select name="isAdminApproved" class="form-select">
                    <option value="">All</option>
                    <option value="true" selected="@(Context.Request.Query["isAdminApproved"] == "true")">Yes</option>
                    <option value="false" selected="@(Context.Request.Query["isAdminApproved"] == "false")">No</option>
                </select>
            </div>

            <div class="col-md-12 d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary w-auto">
                    <i class="bi bi-funnel"></i> Apply Filters
                </button>
            </div>
        </form>

        <!-- Usage by Grade -->
        <h4 class="mb-3">
            <i class="bi bi-bar-chart-line-fill text-primary"></i> Lockers Assigned per Grade
        </h4>
        <table class="table table-bordered table-striped">
            <thead class="table-primary">
                <tr>
                    <th>Grade</th>
                    <th>Lockers Assigned</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.LockerByGrade != null && Model.LockerByGrade.Any())
                {
                    foreach (var item in Model.LockerByGrade)
                    {
                        <tr>
                            <td>@item.Grade</td>
                            <td>@item.Count</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="2" class="text-center text-muted">
                            No data found for selected filters.
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Locker Usage Details -->
        <h4 class="mt-4 mb-3">
            <i class="bi bi-graph-up-arrow text-success"></i> Locker Usage Details
        </h4>
        <table class="table table-bordered table-striped">
            <thead class="table-secondary">
                <tr>
                    <th>Booking Year</th>
                    <th>Parent Email</th>
                    <th>Student School Num</th>
                    <th>Grade</th>
                    <th>Locker Number</th>
                    <th>Assigned Date</th>
                    <th>Admin Approved</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.LockerUsageGrade8and11 != null && Model.LockerUsageGrade8and11.Any())
                {
                    foreach (var item in Model.LockerUsageGrade8and11)
                    {
                        <tr>
                            <td>@item.BookingYear</td>
                            <td>@item.ParentEmail</td>
                            <td>@item.StudentSchoolNumber</td>
                            <td>@item.GradeNumber</td>
                            <td>@item.LockerNumber</td>
                            <td>@item.AssignedDate?.ToString("yyyy-MM-dd")</td>
                            <td>
                                @if (item.IsAdminApproved)
                                {
                                    <span class="badge bg-success">Yes</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning text-dark">No</span>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="text-center text-muted">
                            No results for selected filters.
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Summary -->
        <h4 class="mt-4 mb-2">
            <i class="bi bi-calendar3 text-info"></i> Summary
        </h4>
        <div class="row">
            <div class="col-md-6">
                <p class="fw-bold">
                    📦 Total Assigned Lockers (@ViewBag.SelectedYear):
                    @Model.LockersBookedJanToJun
                </p>
            </div>
            <div class="col-md-6 text-end">
                <p class="text-muted fst-italic">
                    Report generated on @DateTime.Now.ToString("yyyy-MM-dd HH:mm")
                </p>
            </div>
        </div>
    </div>
</div>